<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R Frontend for Rosetta Pedotransfer Functions • rosettaPTF</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="R Frontend for Rosetta Pedotransfer Functions">
<meta property="og:description" content="Access Python rosetta-soil pedotransfer functions in an R environment. Rosetta is a neural network-based model for predicting unsaturated soil hydraulic parameters from basic soil characterization data. The model predicts parameters for the van Genuchten unsaturated soil hydraulic properties model, using sand, silt, and clay, bulk density and water content. The codebase is now maintained by Dr. Todd Skaggs and other U.S. Department of Agriculture employees. This R package is intended to provide for use cases that involve many thousands of calls to the pedotransfer function. Less demanding use cases are encouraged to use the web interface or API endpoint. There are additional wrappers of the API endpoints provided by the soilDB R package `ROSETTA()` method.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rosettaPTF</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="rosettaptf">rosettaPTF<a class="anchor" aria-label="anchor" href="#rosettaptf"></a>
</h1></div>
<!-- badges: start -->
<p>Rosetta is a neural network-based model for predicting unsaturated soil hydraulic parameters from basic soil characterization data. The model predicts parameters for the van Genuchten unsaturated soil hydraulic properties model, using sand, silt, and clay, bulk density and water content.</p>
<p>{rosettaPTF} uses {reticulate} to wrap the Python <a href="https://github.com/usda-ars-ussl/rosetta-soil" class="external-link">rosetta-soil</a> module: providing several versions of the <a href="http://ncss-tech.github.io/AQP/soilDB/ROSETTA-API.html" class="external-link">Rosetta</a> pedotransfer functions in an R environment.</p>
<p>This package is primarily intended for more demanding use cases (such as calling Rosetta “continuously” on each cell in a stack of rasters), or for accessing the uncertainty and shape metrics from Zhang &amp; Schaap (2017). High-throughput input to the pedotransfer function is possible by using RasterStack (<a href="https://github.com/rspatial/raster/" class="external-link">raster</a>) or SpatRaster (<a href="https://github.com/rspatial/terra/" class="external-link">terra</a>) objects as input.</p>
<div class="section level2">
<h2 id="install-rosettaptf">Install {rosettaPTF}<a class="anchor" aria-label="anchor" href="#install-rosettaptf"></a>
</h2>
<p>First, install the package from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://remotes.r-lib.org" class="external-link">"remotes"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ncss-tech/rosettaPTF"</span><span class="op">)</span></span></code></pre></div>
<p>Then load the <code>rosetta-soil</code> module by loading the R package. If you do not have an available <code>python</code> installation or <code>rosetta-soil</code> module you will be notified.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rosettaPTF</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="rosetta-soil-python-module">
<code>rosetta-soil</code> Python module<a class="anchor" aria-label="anchor" href="#rosetta-soil-python-module"></a>
</h3>
<p>The <a href="https://github.com/usda-ars-ussl/rosetta-soil" class="external-link">rosetta-soil</a> module is a Python package maintained by Dr. Todd Skaggs (USDA-ARS) and other U.S. Department of Agriculture employees.</p>
<p>The Rosetta pedotransfer function predicts five parameters for the van Genuchten model of unsaturated soil hydraulic properties</p>
<ul>
<li>
<code>theta_r</code> : residual volumetric water content</li>
<li>
<code>theta_s</code> : saturated volumetric water content</li>
<li>
<code>log10(alpha)</code> : retention shape parameter <code>[log10(1/cm)]</code>
</li>
<li>
<code>log10(n)</code> : retention shape parameter (also referred to as <code>npar</code>)</li>
<li>
<code>log10(ksat)</code> : saturated hydraulic conductivity <code>[log10(cm/d)]</code>
</li>
</ul>
<p>For each set of input data a mean and standard deviation of each parameter is given.</p>
<p>Less demanding use cases are encouraged to use the web interface or API endpoint. There are additional wrappers of the API endpoints provided by the soilDB R package <code><a href="https://ncss-tech.github.io/soilDB/reference/ROSETTA.html" class="external-link">ROSETTA()</a></code> method. For small amounts of data consider using the interactive version that has copy/paste functionality: <a href="https://www.handbook60.org/rosetta" class="external-link uri">https://www.handbook60.org/rosetta</a>.</p>
</div>
</div>
</div>
<div class="section level1">
<h1 id="input-data">Input Data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h1>
<p>The <a href="http://ncss-tech.github.io/AQP/soilDB/ROSETTA-API.html" class="external-link">Rosetta</a> model relies on a minimum of 3 soil properties, with increasing (expected) accuracy as additional properties are included:</p>
<ul>
<li><p>Required, <code>sand</code>, <code>silt</code>, <code>clay</code>: USDA soil texture separates (percentages) that sum to 100%</p></li>
<li><p>Optional, <code>bulk density (any moisture basis)</code>: mass per volume after accounting for &gt;2mm fragments, units of grams/cm3</p></li>
<li><p>Optional, <code>volumetric water content at 33 kPa</code>: roughly “field capacity” for most soils, units of cm3/cm3</p></li>
<li><p>Optional, <code>volumetric water content at 1500 kPa</code>: roughly “permanent wilting point” for most plants, units of cm3/cm3</p></li>
</ul>
<p>The default order of inputs is: <code>sand</code>, <code>silt</code>, <code>clay</code>, <code>bulk density (any basis)</code>, <code>water content (field capacity; 33 kPa)</code>, <code>water content (permanent wilting point; 1500 kPa)</code> of which the first three are required.</p>
<p>If you specify field capacity water content, you must specify bulk density. If you specify permanent wilting point water content you must also specify bulk density and field capacity water content.</p>
<div class="section level2">
<h2 id="reticulate-setup">{reticulate} Setup<a class="anchor" aria-label="anchor" href="#reticulate-setup"></a>
</h2>
<p>If you are using this package for the first time you will need to have Python installed and you will need to download the necessary modules.</p>
<p>You can set up {reticulate} to install modules into a virtual or Conda environment. {reticulate} offers <code><a href="https://rstudio.github.io/reticulate/reference/install_python.html" class="external-link">reticulate::install_python()</a></code> and <code><a href="https://rstudio.github.io/reticulate/reference/install_miniconda.html" class="external-link">reticulate::install_miniconda()</a></code> to download and set up Python/Conda if you have not yet done so.</p>
<div class="section level3">
<h3 id="finding-the-python-binaries">Finding the <code>python</code> binaries<a class="anchor" aria-label="anchor" href="#finding-the-python-binaries"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rosettaPTF</span><span class="fu">::</span><span class="fu"><a href="reference/find_python.html">find_python</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "C:/Program Files/Python310/python.exe"</span></span></code></pre></div>
<p><code><a href="reference/find_python.html">find_python()</a></code> provides heuristics for setting up {reticulate} to use Python in commonly installed locations.</p>
<p>The first attempt makes use of <code><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which()</a></code> to find installations available in the user path directory.</p>
<p><code><a href="reference/find_python.html">find_python()</a></code> also provides an option for using ArcGIS Pro Conda environments–which may be needed for users who cannot install Conda by some other means. To use this option specify the <code>arcpy_path</code> argument or the <code>rosettaPTF.arcpy_path</code> option to locate both the ArcGIS Pro Conda environment and Python binaries in <em>C:/Program Files/ArcGIS/Pro/bin/Python</em>, for example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rosettaPTF</span><span class="fu">::</span><span class="fu"><a href="reference/find_python.html">find_python</a></span><span class="op">(</span>arcpy_path <span class="op">=</span> <span class="st">"C:/Program Files/ArcGIS/Pro/bin/Python"</span><span class="op">)</span></span></code></pre></div>
<p>If automatic configuration via <code><a href="reference/find_python.html">find_python()</a></code> fails (returns <code>NULL</code>) you can manually set a path to the <code>python</code> executable with the {reticulate} <code>RETICULATE_PYTHON</code> environment variable: <code>Sys.setenv(RETICULATE_PYTHON = "path/to/python")</code> or <code>reticulate::use_python("path/to/python")</code></p>
</div>
<div class="section level3">
<h3 id="install-rosetta-soil-python-module">Install <code>rosetta-soil</code> Python Module<a class="anchor" aria-label="anchor" href="#install-rosetta-soil-python-module"></a>
</h3>
<p>The {rosettaPTF} <code><a href="reference/install_rosetta.html">install_rosetta()</a></code> method wraps <code>reticulate::py_install("rosetta-soil")</code>.</p>
<p>You can use <code><a href="reference/install_rosetta.html">install_rosetta()</a></code> to install into custom environments by specifying <code>envname</code> as needed. After installing a new version of the module you should restart your R session.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rosettaPTF</span><span class="fu">::</span><span class="fu"><a href="reference/install_rosetta.html">install_rosetta</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using virtual environment "~/.virtualenvs/r-reticulate" ...</span></span>
<span><span class="co">#&gt; Error in system2(python, c("-c", shQuote(command)), stdout = TRUE, stderr = TRUE) : </span></span>
<span><span class="co">#&gt;   'CreateProcess' failed to run 'C:\Users\ANDREW~1.BRO\DOCUME~1\VIRTUA~1\R-RETI~1\Scripts\python.exe -c "import sys; import pip; sys.stdout.write(pip.__version__)"'</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Alternately, to install the module manually with <code>pip</code> you can run the following command. This assumes a Python 3 binary called <code>python</code> can be found on your path.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="ex">python</span> -m pip install rosetta-soil</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="run_rosetta">
<code>run_rosetta()</code><a class="anchor" aria-label="anchor" href="#run_rosetta"></a>
</h2>
<p>Batch runs of Rosetta models can be done using using <code>list</code>, <code>data.frame</code>, <code>matrix</code>, <code>RasterStack</code>, <code>RasterBrick</code> and <code>SpatRaster</code> objects as input.</p>
<div class="section level3">
<h3 id="list-input-example">
<code>list()</code> Input Example<a class="anchor" aria-label="anchor" href="#list-input-example"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/run_rosetta.html">run_rosetta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">1.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">25</span>, <span class="fl">20</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">25</span>, <span class="fl">20</span>, <span class="fl">1.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            rosetta_version <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id model_code theta_r_mean theta_s_mean log10_alpha_mean log10_npar_mean</span></span>
<span><span class="co">#&gt; 1  1          3   0.11535773    0.4179120        -2.067139       0.1120102</span></span>
<span><span class="co">#&gt; 2  2          2   0.08613275    0.3888528        -1.898150       0.1347136</span></span>
<span><span class="co">#&gt; 3  3          3   0.09130753    0.4850320        -2.022388       0.1510716</span></span>
<span><span class="co">#&gt;   log10_Ksat_mean  theta_r_sd  theta_s_sd log10_alpha_sd log10_npar_sd</span></span>
<span><span class="co">#&gt; 1       0.8325407 0.013350113 0.009377977     0.08251142    0.01323413</span></span>
<span><span class="co">#&gt; 2       1.1858005 0.006014445 0.006273536     0.07481303    0.01160419</span></span>
<span><span class="co">#&gt; 3       1.9060148 0.012771407 0.013062171     0.10020312    0.01763982</span></span>
<span><span class="co">#&gt;   log10_Ksat_sd</span></span>
<span><span class="co">#&gt; 1    0.09245277</span></span>
<span><span class="co">#&gt; 2    0.08428578</span></span>
<span><span class="co">#&gt; 3    0.14163567</span></span></code></pre></div>
<p>Output <code>model_code</code> reflects the number of parameters in the input.</p>
</div>
<div class="section level3">
<h3 id="dataframe-input-example">
<code>data.frame()</code> Input Example<a class="anchor" aria-label="anchor" href="#dataframe-input-example"></a>
</h3>
<p>The <code>data.frame</code> interface allows for using using custom column names and order. If the <code>vars</code> argument is not specified it is assumed that the columns are in the order specified in the <code><a href="reference/run_rosetta.html">run_rosetta()</a></code> manual page.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/run_rosetta.html">run_rosetta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  a <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  c <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span>, vars <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id model_code theta_r_mean theta_s_mean log10_alpha_mean log10_npar_mean</span></span>
<span><span class="co">#&gt; 1  1          2   0.08994502    0.4301366        -2.426236       0.1756873</span></span>
<span><span class="co">#&gt; 2  2          3   0.08495731    0.3887858        -2.318826       0.1598879</span></span>
<span><span class="co">#&gt;   log10_Ksat_mean  theta_r_sd  theta_s_sd log10_alpha_sd log10_npar_sd</span></span>
<span><span class="co">#&gt; 1       1.1927311 0.006707593 0.008785824     0.07413139    0.01323068</span></span>
<span><span class="co">#&gt; 2       0.9961317 0.010184683 0.008100061     0.07976954    0.01753829</span></span>
<span><span class="co">#&gt;   log10_Ksat_sd</span></span>
<span><span class="co">#&gt; 1    0.08709446</span></span>
<span><span class="co">#&gt; 2    0.07771481</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="soil-data-access--ssurgo-mapunit-aggregate-input-example">Soil Data Access / SSURGO Mapunit Aggregate Input Example<a class="anchor" aria-label="anchor" href="#soil-data-access--ssurgo-mapunit-aggregate-input-example"></a>
</h3>
<p>This example pulls mapunit/component data from Soil Data Access (SDA). We use the {soilDB} function <code><a href="https://ncss-tech.github.io/soilDB/reference/get_SDA_property.html" class="external-link">get_SDA_property()</a></code> to obtain representative values for <code>sand</code>, <code>silt</code>, <code>clay</code>, and <code>bulk density (1/3 bar)</code> we run Rosetta on the resulting data.frame (one row per mapunit) then use raster attribute table (RAT) to display the results (1:1 with <code>mukey</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ncss-tech.github.io/soilDB/" class="external-link">soilDB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'terra' was built under R version 4.2.1</span></span>
<span><span class="co">#&gt; terra 1.5.50</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rosettaPTF</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># obtain mukey map from SoilWeb Web Coverage Service (800m resolution SSURGO derived)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ncss-tech.github.io/soilDB/reference/mukey.wcs.html" class="external-link">mukey.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">114.16</span>, <span class="fl">47.65</span>,<span class="op">-</span><span class="fl">114.08</span>, <span class="fl">47.68</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">'EPSG:4326'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: sf</span></span>
<span></span>
<span><span class="co"># request input data from SDA</span></span>
<span><span class="va">varnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sandtotal_r"</span>, <span class="st">"silttotal_r"</span>, <span class="st">"claytotal_r"</span>, <span class="st">"dbthirdbar_r"</span><span class="op">)</span></span>
<span><span class="va">resprop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ncss-tech.github.io/soilDB/reference/get_SDA_property.html" class="external-link">get_SDA_property</a></span><span class="op">(</span>property <span class="op">=</span> <span class="va">varnames</span>,</span>
<span>                            method <span class="op">=</span> <span class="st">"Dominant Component (numeric)"</span>,</span>
<span>                            mukeys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># keep only those where we have a complete set of 4 parameters (sand, silt, clay, bulk density; model code #3)</span></span>
<span><span class="va">soildata</span> <span class="op">&lt;-</span> <span class="va">resprop</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">resprop</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mukey"</span>, <span class="va">varnames</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># run Rosetta on the mapunit-level aggregate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">resrose</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_rosetta.html">run_rosetta</a></span><span class="op">(</span><span class="va">soildata</span><span class="op">[</span>,<span class="va">varnames</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    0.14    0.00    0.14</span></span>
<span></span>
<span><span class="co"># transfer mukey to result</span></span>
<span><span class="va">resrose</span><span class="op">$</span><span class="va">mukey</span> <span class="op">&lt;-</span> <span class="va">soildata</span><span class="op">$</span><span class="va">mukey</span></span>
<span></span>
<span><span class="co"># merge property (input) and rosetta parameters (output) into RAT</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">cats</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">resprop</span>, by <span class="op">=</span> <span class="st">"mukey"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">cats</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">resrose</span>, by <span class="op">=</span> <span class="st">"mukey"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert categories based on mukey to numeric values</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/catalyze.html" class="external-link">catalyze</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a plot of the predicted Ksat</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res2</span>, <span class="st">"log10_Ksat_mean"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="spatraster-terra-input-example">
<em>SpatRaster</em> (terra) Input Example<a class="anchor" aria-label="anchor" href="#spatraster-terra-input-example"></a>
</h3>
<p>The above example shows how to create raster output based on <em>discrete</em> (SSURGO polygon derived) data. A more general case is when each raster cell has “unique” values (i.e. <em>continuous</em> raster inputs). <code><a href="reference/run_rosetta.html">run_rosetta()</a></code> has an S3 method defined for <em>SpatRaster</em> input.</p>
<p>We previously merged the input data from SDA (an ordinary <em>data.frame</em>) into the RAT of <code>res</code>; exploiting the linkage between <code>mukey</code> and raster cells to make the map. For comparison with the <code>mukey</code> results above we stack de-ratified input layers and create a new <em>SpatRaster</em>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">res2</span><span class="op">[[</span><span class="st">"sandtotal_r"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">res2</span><span class="op">[[</span><span class="st">"silttotal_r"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">res2</span><span class="op">[[</span><span class="st">"claytotal_r"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">res2</span><span class="op">[[</span><span class="st">"dbthirdbar_r"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># SpatRaster to data.frame interface (one call on all cells)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_rosetta.html">run_rosetta</a></span><span class="op">(</span><span class="va">res3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   28.25    9.05   33.31</span></span>
<span></span>
<span><span class="co"># make a plot of the predicted Ksat (identical to mukey-based results)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">test2</span>, <span class="st">"log10_Ksat_mean"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="100%"></p>
<p>You will notice the results for Ksat distribution are identical since the same input values were used, but the latter approach took longer to run. The time difference is the difference of estimating ~40 (1 estimate per mapunit key) versus ~30,000 (1 estimate per raster cell) sets of Rosetta parameters.</p>
</div>
</div>
<div class="section level2">
<h2 id="extended-output-with-rosetta-s3-class">Extended Output with <code>Rosetta</code> S3 Class<a class="anchor" aria-label="anchor" href="#extended-output-with-rosetta-s3-class"></a>
</h2>
<div class="section level3">
<h3 id="make-a-rosetta-class-instance-for-running-extended-output-methods">Make a <em>Rosetta</em> class instance for running extended output methods<a class="anchor" aria-label="anchor" href="#make-a-rosetta-class-instance-for-running-extended-output-methods"></a>
</h3>
<p>Note that each instance of <em>Rosetta</em> has a fixed version and model code, so if you have heterogeneous input you need to iterate over model code.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># defaults are version 3 and model code 3 (4 parameters: sand, silt, clay and bulk density)</span></span>
<span><span class="va">my_rosetta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Rosetta-class.html">Rosetta</a></span><span class="op">(</span>rosetta_version <span class="op">=</span> <span class="fl">3</span>, model_code <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predict-rosetta-parameter-values-and-standard-deviations-from-a-rosetta-instance">
<code>predict()</code> Rosetta Parameter Values and Standard Deviations from a <em>Rosetta</em> instance<a class="anchor" aria-label="anchor" href="#predict-rosetta-parameter-values-and-standard-deviations-from-a-rosetta-instance"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">my_rosetta</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">1.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">25</span>, <span class="fl">20</span>, <span class="fl">1.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;            [,1]     [,2]      [,3]      [,4]      [,5]</span></span>
<span><span class="co">#&gt; [1,] 0.11535773 0.417912 -2.067139 0.1120102 0.8325407</span></span>
<span><span class="co">#&gt; [2,] 0.09130753 0.485032 -2.022388 0.1510716 1.9060148</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;            [,1]        [,2]       [,3]       [,4]       [,5]</span></span>
<span><span class="co">#&gt; [1,] 0.01335011 0.009377977 0.08251142 0.01323413 0.09245277</span></span>
<span><span class="co">#&gt; [2,] 0.01277141 0.013062171 0.10020312 0.01763982 0.14163567</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extended-rosetta-predictions-parameter-distributions-and-summary-statistics-after-zhang--schaap-2017-with-ann_predict">Extended <em>Rosetta</em> Predictions, Parameter Distributions and Summary Statistics after Zhang &amp; Schaap (2017) with <code>ann_predict()</code>
<a class="anchor" aria-label="anchor" href="#extended-rosetta-predictions-parameter-distributions-and-summary-statistics-after-zhang--schaap-2017-with-ann_predict"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ann_predict.html">ann_predict</a></span><span class="op">(</span><span class="va">my_rosetta</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">1.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">25</span>, <span class="fl">20</span>, <span class="fl">1.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ann_predict() is defined for objects with class Rosetta; see `Rosetta()` to create a new instance</span></span>
<span><span class="co">#&gt; $var_names</span></span>
<span><span class="co">#&gt; $var_names[[1]]</span></span>
<span><span class="co">#&gt; b'theta_r'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $var_names[[2]]</span></span>
<span><span class="co">#&gt; b'theta_s'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $var_names[[3]]</span></span>
<span><span class="co">#&gt; b'alpha'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $var_names[[4]]</span></span>
<span><span class="co">#&gt; b'npar'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $var_names[[5]]</span></span>
<span><span class="co">#&gt; b'ks'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sum_res_mean</span></span>
<span><span class="co">#&gt;            [,1]        [,2]</span></span>
<span><span class="co">#&gt; [1,]  0.1153577  0.09130753</span></span>
<span><span class="co">#&gt; [2,]  0.4179120  0.48503196</span></span>
<span><span class="co">#&gt; [3,] -2.0671385 -2.02238809</span></span>
<span><span class="co">#&gt; [4,]  0.1120102  0.15107161</span></span>
<span><span class="co">#&gt; [5,]  0.8325407  1.90601478</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sum_res_std</span></span>
<span><span class="co">#&gt;             [,1]       [,2]</span></span>
<span><span class="co">#&gt; [1,] 0.013350113 0.01277141</span></span>
<span><span class="co">#&gt; [2,] 0.009377977 0.01306217</span></span>
<span><span class="co">#&gt; [3,] 0.082511421 0.10020312</span></span>
<span><span class="co">#&gt; [4,] 0.013234131 0.01763982</span></span>
<span><span class="co">#&gt; [5,] 0.092452769 0.14163567</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sum_res_cov</span></span>
<span><span class="co">#&gt; , , 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              [,1]         [,2]          [,3]          [,4]         [,5]</span></span>
<span><span class="co">#&gt; [1,] 1.782255e-04 3.719987e-05  5.300747e-05  2.278859e-05 5.965812e-05</span></span>
<span><span class="co">#&gt; [2,] 3.719987e-05 8.794645e-05  2.570007e-04  3.632187e-06 2.662337e-04</span></span>
<span><span class="co">#&gt; [3,] 5.300747e-05 2.570007e-04  6.808135e-03 -3.601399e-04 1.347519e-03</span></span>
<span><span class="co">#&gt; [4,] 2.278859e-05 3.632187e-06 -3.601399e-04  1.751422e-04 8.973559e-05</span></span>
<span><span class="co">#&gt; [5,] 5.965812e-05 2.662337e-04  1.347519e-03  8.973559e-05 8.547515e-03</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               [,1]          [,2]          [,3]          [,4]          [,5]</span></span>
<span><span class="co">#&gt; [1,]  1.631088e-04  2.342660e-05  2.087559e-05 -9.477980e-06 -0.0003382175</span></span>
<span><span class="co">#&gt; [2,]  2.342660e-05  1.706203e-04  3.156961e-04 -4.577936e-05  0.0005664825</span></span>
<span><span class="co">#&gt; [3,]  2.087559e-05  3.156961e-04  1.004067e-02 -7.685234e-04  0.0012668368</span></span>
<span><span class="co">#&gt; [4,] -9.477980e-06 -4.577936e-05 -7.685234e-04  3.111634e-04  0.0001828960</span></span>
<span><span class="co">#&gt; [5,] -3.382175e-04  5.664825e-04  1.266837e-03  1.828960e-04  0.0200606627</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sum_res_skew</span></span>
<span><span class="co">#&gt;             [,1]        [,2]</span></span>
<span><span class="co">#&gt; [1,] -4.52570431 -2.33577302</span></span>
<span><span class="co">#&gt; [2,] -0.01729594 -0.22228088</span></span>
<span><span class="co">#&gt; [3,] -0.18215435 -0.25961263</span></span>
<span><span class="co">#&gt; [4,] -0.15345973  0.04145318</span></span>
<span><span class="co">#&gt; [5,] -0.20386127 -0.35765020</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sum_res_kurt</span></span>
<span><span class="co">#&gt;            [,1]        [,2]</span></span>
<span><span class="co">#&gt; [1,] 36.6873026 16.85229297</span></span>
<span><span class="co">#&gt; [2,]  0.5975976  0.02966211</span></span>
<span><span class="co">#&gt; [3,]  0.3016512  0.11663125</span></span>
<span><span class="co">#&gt; [4,]  0.1342581  0.26557316</span></span>
<span><span class="co">#&gt; [5,]  0.3127817  0.54242091</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sum_res_bool</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] TRUE TRUE</span></span>
<span><span class="co">#&gt; [2,] TRUE TRUE</span></span>
<span><span class="co">#&gt; [3,] TRUE TRUE</span></span>
<span><span class="co">#&gt; [4,] TRUE TRUE</span></span>
<span><span class="co">#&gt; [5,] TRUE TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nsamp</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nout</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nin</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="selected-references">Selected References<a class="anchor" aria-label="anchor" href="#selected-references"></a>
</h2>
<p>Three versions of the ROSETTA model are available, selected using <code>rosetta_version</code> argument.</p>
<ul>
<li><p><code>rosetta_version</code> 1 - Schaap, M.G., F.J. Leij, and M.Th. van Genuchten. 2001. ROSETTA: a computer program for estimating soil hydraulic parameters with hierarchical pedotransfer functions. Journal of Hydrology 251(3-4): 163-176. doi: 10.1016/S0022-1694(01)00466-8.</p></li>
<li><p><code>rosetta_version</code> 2 - Schaap, M.G., A. Nemes, and M.T. van Genuchten. 2004. Comparison of Models for Indirect Estimation of Water Retention and Available Water in Surface Soils. Vadose Zone Journal 3(4): 1455-1463. doi: 10.2136/vzj2004.1455.</p></li>
<li><p><code>rosetta_version</code> 3 - Zhang, Y., and M.G. Schaap. 2017. Weighted recalibration of the Rosetta pedotransfer model with improved estimates of hydraulic parameter distributions and summary statistics (Rosetta3). Journal of Hydrology 547: 39-53. doi: 10.1016/j.jhydrol.2017.01.004.</p></li>
</ul>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 2)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rosettaPTF</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Andrew Brown <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ncss-tech/rosettaPTF/actions" class="external-link"><img src="https://github.com/ncss-tech/rosettaPTF/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://ncss-tech.github.io/rosettaPTF/" class="external-link"><img src="https://camo.githubusercontent.com/f7ba98e46ecd14313e0e8a05bec3f92ca125b8f36302a5b1679d4a949bccbe31/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d48544d4c2d696e666f726d6174696f6e616c" alt="HTML Docs"></a></li>
<li><a href="https://codecov.io/gh/ncss-tech/rosettaPTF" class="external-link"><img src="https://codecov.io/gh/ncss-tech/rosettaPTF/branch/main/graph/badge.svg?token=BYBKW7PKC3" alt="codecov"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrew Brown.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
